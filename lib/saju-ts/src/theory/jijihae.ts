/**
 * 지지해론(地支害論) — 지지 육해(六害) 이론
 *
 * 해(害)란 두 지지가 서로 방해하거나 상처를 주는 관계로,
 * 육합(六合)을 파괴하는 기운에서 발생한다.
 *
 * 육해(六害)는 육합(六合) 관계의 반대편에 있는 충(沖)의 지지가
 * 합을 방해함으로써 생기는 구조로 이해된다.
 *
 * 자미(子未)·축오(丑午)·인사(寅巳)·묘진(卯辰)·신해(申亥)·유술(酉戌)
 */

// ---------------------------------------------------------------------------
// 지지 이름 타입
// ---------------------------------------------------------------------------

export type BranchName =
  | 'JA' | 'CHUK' | 'IN' | 'MYO' | 'JIN' | 'SA'
  | 'O' | 'MI' | 'SHIN' | 'YU' | 'SUL' | 'HAE';

// ---------------------------------------------------------------------------
// 육해(六害) 목록
// ---------------------------------------------------------------------------

/**
 * 지지해(地支害) 단일 항목 인터페이스
 */
export interface JijiHae {
  /** 두 지지 로마자 */
  branches: [BranchName, BranchName];
  /** 해의 명칭 */
  name: string;
  /** 해의 원리 — 어떤 합을 방해하는가 */
  origin: string;
  /** 해의 성질 */
  nature: string;
  /** 해의 주요 작용 */
  effect: string;
}

/**
 * 육해(六害) 목록
 *
 * 해(害)의 구조: 두 지지가 각각 육합하는 상대방이 서로 충(沖) 관계일 때 해가 성립한다.
 * 예) 子丑합, 子의 충은 午 → 丑午해 성립 / 丑의 충은 未 → 子未해 성립
 */
export const YUKHAE_PAIRS: JijiHae[] = [
  {
    branches: ['JA', 'MI'],             // 子未害
    name:     '자미해(子未害)',
    origin:   '子는 丑과 육합(合土)하는데, 丑의 충(沖)은 未다. 따라서 未가 子丑合을 방해하여 子未害 성립.',
    nature:   '수(水)와 토(土)의 해. 토극수(土剋水)의 극 관계가 내재되어 있다.',
    effect:   '신장·비장 질환·고독감·배신당함·마음의 상처와 연관.',
  },
  {
    branches: ['CHUK', 'O'],            // 丑午害
    name:     '축오해(丑午害)',
    origin:   '午는 未와 육합(合土)하는데, 未의 충(沖)은 丑이다. 따라서 丑이 午未合을 방해하여 丑午害 성립.',
    nature:   '토(土)와 화(火)의 해. 丑의 차가운 습토(濕土)가 午의 열기를 억누른다.',
    effect:   '심장·비장 질환·배우자와의 갈등·재물 손실과 연관.',
  },
  {
    branches: ['IN', 'SA'],             // 寅巳害
    name:     '인사해(寅巳害)',
    origin:   '寅은 亥와 육합(合木)하는데, 亥의 충(沖)은 巳다. 따라서 巳가 寅亥合을 방해하여 寅巳害 성립.',
    nature:   '목(木)과 화(火)의 해. 목생화(木生火) 상생 관계이지만 해를 이룬다. 은인이 원수가 되는 형상.',
    effect:   '간담(肝膽)·심장 질환·믿었던 사람에게 배신당함·형제간 다툼과 연관.',
  },
  {
    branches: ['MYO', 'JIN'],           // 卯辰害
    name:     '묘진해(卯辰害)',
    origin:   '卯는 戌과 육합(合火)하는데, 戌의 충(沖)은 辰이다. 따라서 辰이 卯戌合을 방해하여 卯辰害 성립.',
    nature:   '목(木)과 토(土)의 해. 목극토(木剋土)의 극 관계. 이웃한 지지가 해를 이루는 독특한 구조.',
    effect:   '간담·위장 질환·이웃·형제와의 갈등·작은 손해의 지속과 연관.',
  },
  {
    branches: ['SHIN', 'HAE'],          // 申亥害
    name:     '신해해(申亥害)',
    origin:   '亥는 寅과 육합(合木)하는데, 寅의 충(沖)은 申이다. 따라서 申이 寅亥合을 방해하여 申亥害 성립.',
    nature:   '금(金)과 수(水)의 해. 금생수(金生水)의 상생 관계이지만 해를 이룬다.',
    effect:   '폐·신장·방광 질환·관재(官災)·이동·여행 중 사고와 연관.',
  },
  {
    branches: ['YU', 'SUL'],            // 酉戌害
    name:     '유술해(酉戌害)',
    origin:   '酉는 辰과 육합(合金)하는데, 辰의 충(沖)은 戌이다. 따라서 戌이 辰酉合을 방해하여 酉戌害 성립.',
    nature:   '금(金)과 토(土)의 해. 토생금(土生金) 상생 관계이지만 해를 이룬다. 이웃한 지지의 해.',
    effect:   '폐·대장·위장 질환·배우자와의 갈등·사업 파트너와의 불화와 연관.',
  },
];

// ---------------------------------------------------------------------------
// 해(害) 이론 원칙
// ---------------------------------------------------------------------------

/**
 * 해(害) 이론 원칙
 */
export const HAE_PRINCIPLES: {
  definition: string;
  mechanism: string;
  strength: string;
  gilhyung: string;
} = {
  definition:
    '해(害)는 두 지지가 서로의 육합(六合)을 방해하는 관계에서 발생하는 ' +
    '상호 상처·방해의 기운이다. ' +
    '형(刑)·충(沖)과 달리 직접적 충돌보다는 간접적·지속적 방해로 손상을 일으킨다.',
  mechanism:
    '해(害)의 발생 원리: A와 B가 육합하는 관계일 때, B의 충(沖) 상대인 C가 A를 만나면 ' +
    'A와 C 사이에 해(害)가 형성된다. C가 A-B 합을 방해하기 때문이다.',
  strength:
    '충(沖) > 형(刑) > 파(破) > 해(害): 해는 네 가지 지지 관계 중 작용력이 가장 약하다. ' +
    '그러나 해당 십신의 기운을 서서히 약화시키며, 원국에 있으면 평생 그 영향이 지속된다.',
  gilhyung:
    '해는 일반적으로 흉(凶)으로 작용하지만 경우에 따라 중립적일 수 있다. ' +
    '기신(忌神) 지지가 해를 당하면 기신의 작용이 약화되어 오히려 길(吉)하게 작용하기도 한다.',
};

// ---------------------------------------------------------------------------
// 유틸리티 함수
// ---------------------------------------------------------------------------

/**
 * 두 지지 이름이 해(害) 관계인지 확인한다
 *
 * @param a - 첫 번째 지지 로마자
 * @param b - 두 번째 지지 로마자
 * @returns 해 관계이면 true
 *
 * @example
 * isHae('JA', 'MI')   // true  — 자미해
 * isHae('YU', 'SUL')  // true  — 유술해
 * isHae('JA', 'IN')   // false — 해 관계 아님
 */
export function isHae(a: BranchName, b: BranchName): boolean {
  return YUKHAE_PAIRS.some(
    pair => (pair.branches[0] === a && pair.branches[1] === b) ||
            (pair.branches[0] === b && pair.branches[1] === a),
  );
}

/**
 * 주어진 지지의 해(害) 상대 지지를 반환한다
 *
 * @param branch - 지지 로마자
 * @returns 해 상대 지지 (없으면 null)
 *
 * @example
 * getHaePartner('JA')   // 'MI'
 * getHaePartner('YU')   // 'SUL'
 */
export function getHaePartner(branch: BranchName): BranchName | null {
  for (const pair of YUKHAE_PAIRS) {
    if (pair.branches[0] === branch) return pair.branches[1];
    if (pair.branches[1] === branch) return pair.branches[0];
  }
  return null;
}
