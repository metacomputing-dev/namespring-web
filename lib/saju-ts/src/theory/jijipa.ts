/**
 * 지지파론(地支破論) — 지지 육파(六破) 이론
 *
 * 파(破)란 두 지지가 서로 파괴하는 관계로,
 * 합(合)을 깨뜨리거나 사물을 손상시키는 작용을 한다.
 * 형(刑)·충(沖)보다 작용력이 약하나 점진적으로 손상을 일으킨다.
 *
 * 육파(六破) — 지지 인덱스 기준:
 * 子酉(0·9), 丑辰(1·4), 寅亥(2·11), 卯午(3·6), 巳申(5·8), 未戌(7·10)
 *
 * 파(破)의 도출 원리:
 * 파는 삼합(三合) 관계에서 도출된다. 삼합의 왕지(旺地)끼리
 * 합하지 못하고 엇갈리는 관계가 파다.
 * - 子(水왕지)와 酉(金왕지): 申子辰 수국과 巳酉丑 금국이 엇갈림
 * - 丑(金고지)와 辰(水고지): 사고지(四庫地) 내의 엇갈림
 * - 寅(火생지)와 亥(水생지): 사생지(四生地) 내의 엇갈림
 * - 卯(木왕지)와 午(火왕지): 亥卯未 목국과 寅午戌 화국이 엇갈림
 * - 巳(金생지)와 申(水생지): 사생지(四生地) 내의 엇갈림
 * - 未(木고지)와 戌(火고지): 사고지(四庫地) 내의 엇갈림
 */

// ---------------------------------------------------------------------------
// 지지 이름 타입
// ---------------------------------------------------------------------------

export type BranchName =
  | 'JA' | 'CHUK' | 'IN' | 'MYO' | 'JIN' | 'SA'
  | 'O' | 'MI' | 'SHIN' | 'YU' | 'SUL' | 'HAE';

// ---------------------------------------------------------------------------
// 파(破)의 영향 강도
// ---------------------------------------------------------------------------

/**
 * 파(破)의 영향 강도를 나타내는 등급.
 * 각 조합마다 파의 영향 정도가 다르며, 이는 관여된 오행의 관계에 따라 결정된다.
 *
 * - STRONG: 극(剋) 관계가 내재되어 있거나, 합(合)과 동시에 성립하여 불안정성이 큰 경우
 * - MODERATE: 같은 오행끼리의 파 또는 상생 관계의 파
 * - MILD: 상생 관계의 파로 극의 요소가 적은 경우
 */
export type PaStrength = 'STRONG' | 'MODERATE' | 'MILD';

// ---------------------------------------------------------------------------
// 육파(六破) 목록
// ---------------------------------------------------------------------------

/**
 * 지지파(地支破) 단일 항목 인터페이스
 */
export interface JijiPa {
  /** 두 지지 로마자 */
  branches: [BranchName, BranchName];
  /** 파의 명칭 */
  name: string;
  /** 파의 성질 */
  nature: string;
  /** 파의 주요 작용 */
  effect: string;
  /** 영향 강도 */
  strength: PaStrength;
  /** 건강 영향 */
  health: string;
  /** 성격·관계 영향 */
  personalRelation: string;
  /** 해소 조건 — 어떤 합(合)이 파를 완화하는가 */
  resolution: string;
}

/**
 * 육파(六破) 목록
 *
 * 파는 합(合)을 방해하거나 관계를 손상시키는 기운으로,
 * 충(沖)·형(刑)보다 직접적이지 않지만 서서히 관계를 파괴한다.
 */
export const YUKPA_PAIRS: JijiPa[] = [
  {
    branches: ['JA', 'YU'],             // 子酉破
    name:     '자유파(子酉破)',
    nature:
      '수(水)와 금(金)의 파. 子는 수(水)의 왕지, 酉는 금(金)의 왕지로 ' +
      '금생수(金生水)의 상생 관계이지만 파를 이룬다. ' +
      '왕지(旺地)끼리의 파로, 각자의 기운이 너무 강하여 ' +
      '서로 돕기보다 기세 싸움이 벌어지는 형상이다. ' +
      '酉는 子를 생하지만 子가 그 생(生)을 받아들이지 않고 부딪히는 구조.',
    effect:
      '인간관계 파탄·배신·구설과 연관. 특히 친밀한 관계(친구, 연인)에서 ' +
      '기대를 저버리는 일, 뒤통수를 치는 일이 발생하기 쉽다.',
    strength: 'MODERATE',
    health:
      '신장(子-水)·폐(酉-金) 관련 질환. 비뇨기 질환, 호흡기 질환, ' +
      '피부 알러지, 기관지 문제에 유의.',
    personalRelation:
      '도움을 주는 관계(상생)인데도 마찰이 생기는 역설적 상황. ' +
      '부모가 자녀를 도우려 하나 자녀가 거부하는 형상, ' +
      '또는 호의가 오해를 사는 관계. 子는 도화(桃花)이므로 ' +
      '이성 관계에서의 파탄과 연관되기도 한다.',
    resolution:
      '子가 丑과 육합(子丑合土)하거나 酉가 辰과 육합(辰酉合金)하면 파가 약화된다. ' +
      '申子辰 수국 삼합이 완성되면 子의 기운이 삼합에 흡수되어 파의 작용이 줄어든다.',
  },
  {
    branches: ['CHUK', 'JIN'],          // 丑辰破
    name:     '축진파(丑辰破)',
    nature:
      '토(土)와 토(土)의 파. 같은 오행끼리의 파로 내부 다툼·고집의 성질이 있다. ' +
      '丑은 겨울의 습토(濕土), 辰은 봄의 습토(濕土)로 ' +
      '모두 습한 성질이지만 계절이 달라 성격이 다르다. ' +
      '丑은 금(金)의 고(庫), 辰은 수(水)의 고(庫)로 저장하는 것이 달라 충돌한다.',
    effect:
      '부동산·토지 관련 손실, 상속·재산 분쟁과 연관. ' +
      '같은 토끼리의 다툼이므로 내부 분열, 조직 내 갈등의 성격이 강하다.',
    strength: 'MILD',
    health:
      '위장·소화기 질환, 비장 기능 저하. 습토끼리의 파로 ' +
      '체내 습기(濕氣) 과다, 부종, 소화불량이 올 수 있다.',
    personalRelation:
      '형제·친척 간 재산 다툼, 동업자 간 의견 충돌. ' +
      '같은 성질의 사람끼리 경쟁하는 형상으로, ' +
      '비슷한 위치에 있는 사람 사이의 갈등을 나타낸다.',
    resolution:
      '丑이 子와 육합(子丑合土)하거나 辰이 酉와 육합(辰酉合金)하면 파가 약화. ' +
      '巳酉丑 금국 삼합이 丑을, 申子辰 수국 삼합이 辰을 흡수하면 파가 해소된다.',
  },
  {
    branches: ['IN', 'HAE'],            // 寅亥破
    name:     '인해파(寅亥破)',
    nature:
      '목(木)과 수(水)의 파. 寅亥는 육합(六合) 합목(合木) 관계이지만 파도 성립한다. ' +
      '합과 파가 동시에 존재하여 관계의 불안정함을 나타낸다. ' +
      '亥(水)가 寅(木)을 생하는 수생목(水生木) 상생이면서도 ' +
      '파의 기운이 합을 흔들어 합이 완전하지 못하게 한다.',
    effect:
      '합(合)이 깨지는 것과 관련된 사건 — 계약 파기, 약속 불이행, ' +
      '신뢰 붕괴. 믿었던 관계가 흔들리는 일과 연관.',
    strength: 'STRONG',
    health:
      '간담(肝膽, 寅-木)·신장(HAE-水) 질환. 간 기능 저하, ' +
      '신장 질환, 수분 대사 이상에 유의. ' +
      '합과 파가 겹쳐 질환이 잠복했다가 갑자기 발현되는 패턴.',
    personalRelation:
      '가장 친한 사이에서 가장 큰 배신이 오는 형상. ' +
      '육합 관계이므로 원래 친밀한 관계인데, 파가 작용하면 ' +
      '친밀함이 갑자기 파탄으로 바뀐다. 동업자·사업 파트너와의 불화, ' +
      '약혼 파기, 이혼 등과 연관.',
    resolution:
      '寅이 午·戌과 함께 寅午戌 화국 삼합을 이루거나, ' +
      '亥가 卯·未와 함께 亥卯未 목국 삼합을 이루면 파의 작용이 약화된다. ' +
      '단, 寅亥 육합 자체가 파를 내포하므로 완전한 해소는 어렵다.',
  },
  {
    branches: ['MYO', 'O'],             // 卯午破
    name:     '묘오파(卯午破)',
    nature:
      '목(木)과 화(火)의 파. 卯는 목의 왕지, 午는 화의 왕지로 ' +
      '목생화(木生火)의 상생 관계이지만 파를 이룬다. ' +
      '木이 火를 생하지만, 두 왕지가 만나면 생(生)의 작용이 과도하여 ' +
      '木이 타버리는(소진되는) 형상이 된다.',
    effect:
      '감정적 충돌, 관계의 급격한 변화와 연관. ' +
      '열정적으로 시작했으나 급격히 식는 관계, ' +
      '소진(번아웃)으로 인한 활동 중단 등.',
    strength: 'MODERATE',
    health:
      '간(卯-木)·심장(午-火) 질환. 간 기능 저하로 인한 심화(心火) 상승, ' +
      '고혈압, 두통, 안구 질환에 유의. 목생화의 과도한 작용으로 ' +
      '허열(虛熱), 불면증이 올 수 있다.',
    personalRelation:
      '초반에 열정적이고 친밀하지만 갑작스러운 감정 변화로 관계가 단절되는 패턴. ' +
      '연인 관계에서 격정적인 사랑이 갑자기 식는 형상. ' +
      '자녀와의 관계에서 과도한 기대가 실망으로 바뀌는 일.',
    resolution:
      '卯가 戌과 육합(卯戌合火)하거나 午가 未와 육합(午未合土)하면 파가 약화. ' +
      '亥卯未 목국이 卯를, 寅午戌 화국이 午를 흡수하면 파의 작용이 줄어든다.',
  },
  {
    branches: ['SA', 'SHIN'],           // 巳申破
    name:     '사신파(巳申破)',
    nature:
      '화(火)와 금(金)의 파. 巳申은 육합(六合) 합수(合水) 관계이면서 파도 성립한다. ' +
      '화극금(火剋金)의 극 관계가 내재되어 있어 육파 중 파괴력이 강한 편이다. ' +
      '합하면서 극하고, 극하면서 파하는 삼중 구조.',
    effect:
      '계약·사업상 파국, 법적 분쟁, 금전 손실과 연관. ' +
      '巳申은 삼형(寅巳申 무은지형)의 구성원이기도 하여 ' +
      '형과 파가 이중으로 작용할 수 있다.',
    strength: 'STRONG',
    health:
      '심장·소장(巳-火)과 폐·대장(申-金) 질환. 화극금의 작용으로 ' +
      '폐 질환, 호흡기 감염, 대장 질환에 특히 유의. ' +
      '고열, 인후통, 편도선 질환도 관련.',
    personalRelation:
      '사업 파트너, 계약 상대와의 관계에서 결렬·파탄이 오는 형상. ' +
      '겉으로는 합의(합)하지만 내면에서 극(剋)과 파(破)가 작용하여 ' +
      '계약 후 분쟁, 합작 후 결렬 등의 문제가 발생한다. ' +
      '특히 재성(財星)이 관련되면 금전적 손실이 크다.',
    resolution:
      '巳가 酉·丑과 함께 巳酉丑 금국 삼합을 이루거나, ' +
      '申이 子·辰과 함께 申子辰 수국 삼합을 이루면 파가 약화. ' +
      '단, 巳申 육합 자체가 파를 내포하므로 寅亥파와 마찬가지로 완전 해소가 어렵다.',
  },
  {
    branches: ['MI', 'SUL'],            // 未戌破
    name:     '미술파(未戌破)',
    nature:
      '토(土)와 토(土)의 파. 미토(未)와 술토(戌)는 같은 토 오행으로 ' +
      '고집과 집착으로 인한 파괴를 상징한다. ' +
      '未는 여름의 조토(燥土), 戌은 가을의 조토(燥土)로 ' +
      '모두 건조하고 뜨거운 성질이어서 만나면 메마르고 갈라지는 형상.',
    effect:
      '고집 대립, 융통성 부족으로 인한 손실, 부동산·토지 문제와 연관. ' +
      '未와 戌은 丑戌未 지세지형(持勢之刑)의 구성원이기도 하여 ' +
      '형과 파가 겹치면 완고한 대립이 더욱 심해진다.',
    strength: 'MILD',
    health:
      '비장·위장·복부 질환, 피부 건조·갈라짐. 조토끼리의 파로 ' +
      '체내 수분 부족, 변비, 위염, 식도 질환에 유의. ' +
      '화(火)의 잔기(戌 속 丁, 未 속 丁)가 중복되어 열성 피부 질환도 관련.',
    personalRelation:
      '서로 양보하지 않는 고집 대립. 비슷한 성격의 사람끼리 ' +
      '의견 충돌이 생기면 해결이 어려운 교착 상태에 빠진다. ' +
      '재산 분배, 상속, 토지 경계 분쟁 등과 연관.',
    resolution:
      '未가 午와 육합(午未合土)하거나 戌이 卯와 육합(卯戌合火)하면 파가 약화. ' +
      '亥卯未 목국이 未를, 寅午戌 화국이 戌을 흡수하면 파의 작용이 줄어든다.',
  },
];

// ---------------------------------------------------------------------------
// 파(破)의 이론 원칙
// ---------------------------------------------------------------------------

/**
 * 파(破) 이론 원칙
 */
export const PA_PRINCIPLES: {
  definition: string;
  mechanism: string;
  strengthOrder: string;
  interaction: string;
  gilhyung: string;
  pairStrengthRanking: string;
} = {
  definition:
    '파(破)는 두 지지가 서로 손상시키는 관계로, 합(合)과 달리 ' +
    '두 지지의 에너지를 약화·분산시킨다. ' +
    '특히 합(合) 관계에 있는 두 지지 중 하나가 파를 당하면 ' +
    '합이 깨지거나 합화(合化)가 방해받는다.',

  mechanism:
    '파(破)의 도출 원리는 삼합(三合)과 관련된다. 삼합의 세 지지(생지·왕지·고지)에서 ' +
    '다른 삼합의 대응 위치 지지와 엇갈리는 관계가 파다. ' +
    '왕지끼리의 파(子酉, 卯午), 생지끼리의 파(寅亥, 巳申), ' +
    '고지끼리의 파(丑辰, 未戌)로 세 유형으로 분류할 수 있다.',

  strengthOrder:
    '충(沖) > 형(刑) > 파(破) > 해(害): 파의 작용력은 충(沖)·형(刑)보다 약하고 해(害)보다 강하다. ' +
    '파는 서서히 손상을 일으키며, 운(運)에서 파가 발동할 때 그 영향이 가장 두드러진다.',

  interaction:
    '파(破)가 합(合)과 동시에 성립하면 합의 효과가 반감되거나 불안정해진다. ' +
    '인해(寅亥)·사신(巳申)은 육합이면서 파이므로 해당 관계는 ' +
    '친밀함과 파탄이 공존하는 불안정한 관계를 나타낸다. ' +
    '이를 "합중파(合中破)" — 합 속에 파가 있다 — 고 한다.',

  gilhyung:
    '파는 주로 흉(凶)으로 작용하지만, 기신(忌神) 지지가 파를 당하면 ' +
    '기신이 약화되어 상대적으로 길(吉)하게 작용할 수 있다. ' +
    '또한 불필요한 합(忌合)을 파가 깨뜨리면 길하게 작용하기도 한다. ' +
    '예: 용신이 합에 묶여 작용하지 못할 때, 파가 합을 풀어주면 용신이 활동하게 된다.',

  pairStrengthRanking:
    '육파의 강도 비교: ' +
    '사신파(巳申破) >= 인해파(寅亥破) > 자유파(子酉破) >= 묘오파(卯午破) > 축진파(丑辰破) >= 미술파(未戌破). ' +
    '합(合)과 겹치는 파(寅亥, 巳申)가 가장 강하고, 극(剋)이 내재된 파(巳申)가 특히 파괴적이다. ' +
    '같은 오행끼리의 파(丑辰, 未戌)는 외부 충돌보다 내부 마찰의 성격이므로 상대적으로 약하다.',
};

// ---------------------------------------------------------------------------
// 파(破)의 주(柱) 위치별 해석
// ---------------------------------------------------------------------------

/**
 * 파가 사주 어느 주(柱)에 위치하느냐에 따른 영향 차이
 */
export const PA_BY_POSITION: Array<{
  position: string;
  interpretation: string;
}> = [
  {
    position: '년주(年柱)와 월주(月柱) 사이',
    interpretation:
      '조상·부모·가문의 기반이 흔들리는 형상. 어린 시절 가정의 불안정, ' +
      '부모의 이혼·별거, 가업 실패 등과 연관.',
  },
  {
    position: '월주(月柱)와 일주(日柱) 사이',
    interpretation:
      '사회생활·직업에서의 손상. 직장 내 관계 파탄, 사업 실패, ' +
      '형제·동료와의 불화 등과 연관.',
  },
  {
    position: '일주(日柱)와 시주(時柱) 사이',
    interpretation:
      '부부·자녀 관계의 손상. 배우자와의 갈등, 자녀와의 단절, ' +
      '말년의 고독과 연관.',
  },
];

// ---------------------------------------------------------------------------
// 유틸리티 함수
// ---------------------------------------------------------------------------

/**
 * 두 지지 이름이 파(破) 관계인지 확인한다
 *
 * @param a - 첫 번째 지지 로마자
 * @param b - 두 번째 지지 로마자
 * @returns 파 관계이면 true
 *
 * @example
 * isPa('JA', 'YU')   // true  — 자유파
 * isPa('IN', 'HAE')  // true  — 인해파
 * isPa('JA', 'O')    // false — 파 관계 아님
 */
export function isPa(a: BranchName, b: BranchName): boolean {
  return YUKPA_PAIRS.some(
    pair => (pair.branches[0] === a && pair.branches[1] === b) ||
            (pair.branches[0] === b && pair.branches[1] === a),
  );
}

/**
 * 주어진 지지의 파(破) 상대 지지를 반환한다
 *
 * @param branch - 지지 로마자
 * @returns 파 상대 지지 (없으면 null)
 *
 * @example
 * getPaPartner('JA')   // 'YU'
 * getPaPartner('CHUK') // 'JIN'
 */
export function getPaPartner(branch: BranchName): BranchName | null {
  for (const pair of YUKPA_PAIRS) {
    if (pair.branches[0] === branch) return pair.branches[1];
    if (pair.branches[1] === branch) return pair.branches[0];
  }
  return null;
}

/**
 * 두 지지 사이의 파(破) 정보를 반환한다
 *
 * @param a - 첫 번째 지지 로마자
 * @param b - 두 번째 지지 로마자
 * @returns 파 정보 객체. 파 관계가 아니면 null
 *
 * @example
 * getPaInfo('JA', 'YU')  // JijiPa { name: '자유파(子酉破)', ... }
 * getPaInfo('JA', 'O')   // null
 */
export function getPaInfo(a: BranchName, b: BranchName): JijiPa | null {
  return YUKPA_PAIRS.find(
    pair => (pair.branches[0] === a && pair.branches[1] === b) ||
            (pair.branches[0] === b && pair.branches[1] === a),
  ) ?? null;
}

/**
 * 두 지지의 파(破) 강도를 반환한다
 *
 * @param a - 첫 번째 지지 로마자
 * @param b - 두 번째 지지 로마자
 * @returns 파 강도. 파 관계가 아니면 null
 *
 * @example
 * getPaStrength('SA', 'SHIN')  // 'STRONG'
 * getPaStrength('MI', 'SUL')   // 'MILD'
 */
export function getPaStrength(a: BranchName, b: BranchName): PaStrength | null {
  const info = getPaInfo(a, b);
  return info?.strength ?? null;
}
