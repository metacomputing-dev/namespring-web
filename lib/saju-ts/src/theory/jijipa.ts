/**
 * 지지파론(地支破論) — 지지 육파(六破) 이론
 *
 * 파(破)란 두 지지가 서로 파괴하는 관계로,
 * 합(合)을 깨뜨리거나 사물을 손상시키는 작용을 한다.
 * 형(刑)·충(沖)보다 작용력이 약하나 점진적으로 손상을 일으킨다.
 *
 * 육파(六破) — 지지 인덱스 기준:
 * 子酉(0·9), 丑辰(1·4), 寅亥(2·11), 卯午(3·6), 巳申(5·8), 未戌(7·10)
 */

// ---------------------------------------------------------------------------
// 지지 이름 타입
// ---------------------------------------------------------------------------

export type BranchName =
  | 'JA' | 'CHUK' | 'IN' | 'MYO' | 'JIN' | 'SA'
  | 'O' | 'MI' | 'SHIN' | 'YU' | 'SUL' | 'HAE';

// ---------------------------------------------------------------------------
// 육파(六破) 목록
// ---------------------------------------------------------------------------

/**
 * 지지파(地支破) 단일 항목 인터페이스
 */
export interface JijiPa {
  /** 두 지지 로마자 */
  branches: [BranchName, BranchName];
  /** 파의 명칭 */
  name: string;
  /** 파의 성질 */
  nature: string;
  /** 파의 주요 작용 */
  effect: string;
}

/**
 * 육파(六破) 목록
 *
 * 파는 합(合)을 방해하거나 관계를 손상시키는 기운으로,
 * 충(沖)·형(刑)보다 직접적이지 않지만 서서히 관계를 파괴한다.
 */
export const YUKPA_PAIRS: JijiPa[] = [
  {
    branches: ['JA', 'YU'],             // 子酉破
    name:     '자유파(子酉破)',
    nature:   '수(水)와 금(金)의 파. 子는 수(水)의 왕지, 酉는 금(金)의 왕지로 ' +
              '금생수(金生水)의 상생 관계이지만 파를 이룬다.',
    effect:   '인간관계 파탄·배신·구설·신체 신장·폐 질환과 연관.',
  },
  {
    branches: ['CHUK', 'JIN'],          // 丑辰破
    name:     '축진파(丑辰破)',
    nature:   '토(土)와 토(土)의 파. 같은 오행끼리의 파로 내부 다툼·고집의 성질이 있다.',
    effect:   '위장·소화기 질환·부동산 손실·형제간 다툼과 연관.',
  },
  {
    branches: ['IN', 'HAE'],            // 寅亥破
    name:     '인해파(寅亥破)',
    nature:   '목(木)과 수(水)의 파. 寅亥는 육합(六合) 합목(合木) 관계이지만 파도 성립한다. ' +
              '합과 파가 동시에 존재하여 관계의 불안정함을 나타낸다.',
    effect:   '간담(肝膽)·신장 질환·믿었던 관계의 배신·사업 실패와 연관.',
  },
  {
    branches: ['MYO', 'O'],             // 卯午破
    name:     '묘오파(卯午破)',
    nature:   '목(木)과 화(火)의 파. 卯는 목의 왕지, 午는 화의 왕지로 ' +
              '목생화(木生火)의 상생 관계이지만 파를 이룬다.',
    effect:   '간·심장 질환·인간관계 단절·감정적 충돌과 연관.',
  },
  {
    branches: ['SA', 'SHIN'],           // 巳申破
    name:     '사신파(巳申破)',
    nature:   '화(火)와 금(金)의 파. 巳申은 육합(六合) 합수(合水) 관계이면서 파도 성립한다. ' +
              '화극금(火剋金)의 극 관계가 내재되어 있다.',
    effect:   '심장·폐·대장 질환·사업상 계약 파기·법적 분쟁과 연관.',
  },
  {
    branches: ['MI', 'SUL'],            // 未戌破
    name:     '미술파(未戌破)',
    nature:   '토(土)와 토(土)의 파. 미토(未)와 술토(戌)는 같은 토 오행으로 ' +
              '고집과 집착으로 인한 파괴를 상징한다.',
    effect:   '비장·위장·복부 질환·고집으로 인한 관계 손상·재물 손실과 연관.',
  },
];

// ---------------------------------------------------------------------------
// 파(破)의 이론 원칙
// ---------------------------------------------------------------------------

/**
 * 파(破) 이론 원칙
 */
export const PA_PRINCIPLES: {
  definition: string;
  strengthOrder: string;
  interaction: string;
  gilhyung: string;
} = {
  definition:
    '파(破)는 두 지지가 서로 손상시키는 관계로, 합(合)과 달리 ' +
    '두 지지의 에너지를 약화·분산시킨다. ' +
    '특히 합(合) 관계에 있는 두 지지 중 하나가 파를 당하면 ' +
    '합이 깨지거나 합화(合化)가 방해받는다.',
  strengthOrder:
    '형충(刑沖) > 파(破) > 해(害): 파의 작용력은 충(沖)보다 약하고 해(害)보다 강하다. ' +
    '파는 서서히 손상을 일으키며, 운(運)에서 파가 발동할 때 그 영향이 가장 두드러진다.',
  interaction:
    '파(破)가 합(合)과 동시에 성립하면 합의 효과가 반감되거나 불안정해진다. ' +
    '인해(寅亥)·사신(巳申)은 육합이면서 파이므로 해당 관계는 ' +
    '친밀함과 파탄이 공존하는 불안정한 관계를 나타낸다.',
  gilhyung:
    '파는 주로 흉(凶)으로 작용하지만, 기신(忌神) 지지가 파를 당하면 ' +
    '기신이 약화되어 상대적으로 길(吉)하게 작용할 수 있다.',
};

// ---------------------------------------------------------------------------
// 유틸리티 함수
// ---------------------------------------------------------------------------

/**
 * 두 지지 이름이 파(破) 관계인지 확인한다
 *
 * @param a - 첫 번째 지지 로마자
 * @param b - 두 번째 지지 로마자
 * @returns 파 관계이면 true
 *
 * @example
 * isPa('JA', 'YU')   // true  — 자유파
 * isPa('IN', 'HAE')  // true  — 인해파
 * isPa('JA', 'O')    // false — 파 관계 아님
 */
export function isPa(a: BranchName, b: BranchName): boolean {
  return YUKPA_PAIRS.some(
    pair => (pair.branches[0] === a && pair.branches[1] === b) ||
            (pair.branches[0] === b && pair.branches[1] === a),
  );
}

/**
 * 주어진 지지의 파(破) 상대 지지를 반환한다
 *
 * @param branch - 지지 로마자
 * @returns 파 상대 지지 (없으면 null)
 *
 * @example
 * getPaPartner('JA')   // 'YU'
 * getPaPartner('CHUK') // 'JIN'
 */
export function getPaPartner(branch: BranchName): BranchName | null {
  for (const pair of YUKPA_PAIRS) {
    if (pair.branches[0] === branch) return pair.branches[1];
    if (pair.branches[1] === branch) return pair.branches[0];
  }
  return null;
}
