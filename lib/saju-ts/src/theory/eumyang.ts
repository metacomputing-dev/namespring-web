/**
 * 음양론(陰陽論) 이론 모듈
 *
 * 음(陰)과 양(陽)은 우주 만물을 이루는 두 가지 상반된 기운으로,
 * 사주명리학에서 천간과 지지 각각에 배속되어 운동 방향과 성질을 결정한다.
 *
 * 양(陽): 하늘·빛·움직임·확산·남성적 기운 → 순행(順行)
 * 음(陰): 땅·어둠·고요함·수렴·여성적 기운 → 역행(逆行)
 */

import type { YinYang, StemIdx, BranchIdx } from '../core/cycle.js';

// ---------------------------------------------------------------------------
// 기본 타입
// ---------------------------------------------------------------------------

/**
 * 음양 한글 로마자 표기
 *
 * core/cycle.ts 의 {@link YinYang} 타입과 동일한 값 집합이다.
 * 이 모듈에서는 음양론 맥락을 명확히 하기 위해 별도 타입으로 재선언한다.
 *
 * - YANG = 양(陽)
 * - YIN  = 음(陰)
 */
export type Eumyang = 'YANG' | 'YIN';

// ---------------------------------------------------------------------------
// 천간 음양 배속(天干陰陽配屬)
// ---------------------------------------------------------------------------

/**
 * 천간(天干) 음양 배속 맵
 *
 * 10천간은 홀수 인덱스(짝수 번째)가 양(陽), 짝수 인덱스(홀수 번째)가 음(陰)이다.
 *
 * | 인덱스 | 천간 | 로마자  | 음양 |
 * |--------|------|---------|------|
 * | 0      | 甲   | GAP     | YANG |
 * | 1      | 乙   | EUL     | YIN  |
 * | 2      | 丙   | BYEONG  | YANG |
 * | 3      | 丁   | JEONG   | YIN  |
 * | 4      | 戊   | MU      | YANG |
 * | 5      | 己   | GI      | YIN  |
 * | 6      | 庚   | GYEONG  | YANG |
 * | 7      | 辛   | SIN     | YIN  |
 * | 8      | 壬   | IM      | YANG |
 * | 9      | 癸   | GYE     | YIN  |
 */
export const STEM_EUMYANG: Record<number, Eumyang> = {
  0: 'YANG', // 甲(GAP)  — 양목(陽木)
  1: 'YIN',  // 乙(EUL)  — 음목(陰木)
  2: 'YANG', // 丙(BYEONG) — 양화(陽火)
  3: 'YIN',  // 丁(JEONG) — 음화(陰火)
  4: 'YANG', // 戊(MU)   — 양토(陽土)
  5: 'YIN',  // 己(GI)   — 음토(陰土)
  6: 'YANG', // 庚(GYEONG) — 양금(陽金)
  7: 'YIN',  // 辛(SIN)  — 음금(陰金)
  8: 'YANG', // 壬(IM)   — 양수(陽水)
  9: 'YIN',  // 癸(GYE)  — 음수(陰水)
};

// ---------------------------------------------------------------------------
// 지지 음양 배속(地支陰陽配屬)
// ---------------------------------------------------------------------------

/**
 * 지지(地支) 음양 배속 맵
 *
 * 12지지도 홀수 인덱스(짝수 번째)가 양(陽), 짝수 인덱스(홀수 번째)가 음(陰)이다.
 *
 * | 인덱스 | 지지 | 로마자 | 음양 |
 * |--------|------|--------|------|
 * | 0      | 子   | JA     | YANG |
 * | 1      | 丑   | CHUK   | YIN  |
 * | 2      | 寅   | IN     | YANG |
 * | 3      | 卯   | MYO    | YIN  |
 * | 4      | 辰   | JIN    | YANG |
 * | 5      | 巳   | SA     | YIN  |
 * | 6      | 午   | O      | YANG |
 * | 7      | 未   | MI     | YIN  |
 * | 8      | 申   | SHIN   | YANG |
 * | 9      | 酉   | YU     | YIN  |
 * | 10     | 戌   | SUL    | YANG |
 * | 11     | 亥   | HAE    | YIN  |
 */
export const BRANCH_EUMYANG: Record<number, Eumyang> = {
  0:  'YANG', // 子(JA)   — 양수(陽水)
  1:  'YIN',  // 丑(CHUK) — 음토(陰土)
  2:  'YANG', // 寅(IN)   — 양목(陽木)
  3:  'YIN',  // 卯(MYO)  — 음목(陰木)
  4:  'YANG', // 辰(JIN)  — 양토(陽土)
  5:  'YIN',  // 巳(SA)   — 음화(陰火)
  6:  'YANG', // 午(O)    — 양화(陽火)
  7:  'YIN',  // 未(MI)   — 음토(陰土)
  8:  'YANG', // 申(SHIN) — 양금(陽金)
  9:  'YIN',  // 酉(YU)   — 음금(陰金)
  10: 'YANG', // 戌(SUL)  — 양토(陽土)
  11: 'YIN',  // 亥(HAE)  — 음수(陰水)
};

// ---------------------------------------------------------------------------
// 음양 특성(陰陽特性) 기술
// ---------------------------------------------------------------------------

/**
 * 음양 특성 인터페이스
 */
export interface EumyangCharacteristic {
  /** 음양 식별자 */
  eumyang: Eumyang;
  /** 성질 — 기본 속성 설명 */
  nature: string;
  /** 운동성 — 순행(順) 또는 역행(逆) */
  motion: string;
  /** 경향 — 성격·행동 경향 */
  tendency: string;
}

/**
 * 음양 특성 테이블
 *
 * 음양의 기본 성질, 운동 방향, 성격 경향을 기술한다.
 */
export const EUMYANG_CHARACTERISTICS: Record<Eumyang, EumyangCharacteristic> = {
  YANG: {
    eumyang:  'YANG',
    nature:   '하늘(天)·빛·열·동(動)·강(剛)·남성적 기운. 위로 오르고 바깥으로 뻗어나가려는 속성.',
    motion:   '순행(順行) — 시계 방향으로 전진하며 생장(生長)·발산(發散)의 방향으로 운동.',
    tendency: '적극적·외향적·진취적·주도적. 변화를 일으키고 새로운 것을 향해 나아가는 경향.',
  },
  YIN: {
    eumyang:  'YIN',
    nature:   '땅(地)·어둠·냉·정(靜)·유(柔)·여성적 기운. 아래로 내려오고 안으로 모이려는 속성.',
    motion:   '역행(逆行) — 반시계 방향으로 수렴하며 수장(收藏)·응집(凝集)의 방향으로 운동.',
    tendency: '소극적·내향적·신중적·보조적. 기존 것을 보존하고 안정을 추구하는 경향.',
  },
};

// ---------------------------------------------------------------------------
// 양간·음간·양지·음지 목록
// ---------------------------------------------------------------------------

/**
 * 양간(陽干) 인덱스 목록
 *
 * 10천간 중 양(陽)에 해당하는 5간의 인덱스:
 * 甲(0)·丙(2)·戊(4)·庚(6)·壬(8)
 */
export const YANG_STEMS: StemIdx[] = [0, 2, 4, 6, 8];

/**
 * 음간(陰干) 인덱스 목록
 *
 * 10천간 중 음(陰)에 해당하는 5간의 인덱스:
 * 乙(1)·丁(3)·己(5)·辛(7)·癸(9)
 */
export const YIN_STEMS: StemIdx[] = [1, 3, 5, 7, 9];

/**
 * 양지(陽支) 인덱스 목록
 *
 * 12지지 중 양(陽)에 해당하는 6지의 인덱스:
 * 子(0)·寅(2)·辰(4)·午(6)·申(8)·戌(10)
 */
export const YANG_BRANCHES: BranchIdx[] = [0, 2, 4, 6, 8, 10];

/**
 * 음지(陰支) 인덱스 목록
 *
 * 12지지 중 음(陰)에 해당하는 6지의 인덱스:
 * 丑(1)·卯(3)·巳(5)·未(7)·酉(9)·亥(11)
 */
export const YIN_BRANCHES: BranchIdx[] = [1, 3, 5, 7, 9, 11];

// ---------------------------------------------------------------------------
// 양순음역(陽順陰逆) 원칙
// ---------------------------------------------------------------------------

/**
 * 양순음역(陽順陰逆) 원칙
 *
 * 대운(大運) 및 세운(歲運) 계산에서 핵심적으로 사용되는 음양 운동 원칙.
 * - 양남음녀(陽男陰女)는 순행(順行): 생일 이후 다음 절기(節氣)까지의 날수로 대운 계산
 * - 음남양녀(陰男陽女)는 역행(逆行): 생일 이전 직전 절기까지의 날수로 대운 계산
 */
export const YANG_SUN_EUM_YEOK: {
  principle: string;
  yangRule: string;
  yinRule: string;
} = {
  principle:
    '양순음역(陽順陰逆): 양(陽)은 순행(順行)하고 음(陰)은 역행(逆行)한다. ' +
    '사주명리학의 대운(大運) 방향을 결정하는 핵심 원칙으로, ' +
    '일간(日干)의 음양과 성별(性別)의 조합으로 대운의 진행 방향을 정한다.',
  yangRule:
    '양간(陽干) 남성·음간(陰干) 여성은 순행(順行): ' +
    '생일(生日) 이후 다음 절기(節氣)까지의 날수를 3으로 나누어 대운(大運) 시작 나이를 구한다. ' +
    '대운은 甲→乙→丙... 순서로 진행한다.',
  yinRule:
    '음간(陰干) 남성·양간(陽干) 여성은 역행(逆行): ' +
    '생일(生日) 이전 직전 절기(節氣)까지의 날수를 3으로 나누어 대운(大運) 시작 나이를 구한다. ' +
    '대운은 癸→壬→辛... 역순으로 진행한다.',
};

// ---------------------------------------------------------------------------
// 유틸리티 함수
// ---------------------------------------------------------------------------

/**
 * 주어진 천간 또는 지지 인덱스가 양(陽)인지 판별한다
 *
 * @param stemOrBranchIdx - 천간(0-9) 또는 지지(0-11) 인덱스
 * @param type - 'STEM'(천간) 또는 'BRANCH'(지지) 구분
 * @returns 양(陽)이면 true, 음(陰)이면 false
 *
 * @example
 * isYang(0, 'STEM')   // true  — 甲(GAP)은 양간
 * isYang(1, 'STEM')   // false — 乙(EUL)은 음간
 * isYang(0, 'BRANCH') // true  — 子(JA)는 양지
 * isYang(1, 'BRANCH') // false — 丑(CHUK)은 음지
 */
export function isYang(stemOrBranchIdx: number, type: 'STEM' | 'BRANCH'): boolean {
  if (type === 'STEM') {
    return STEM_EUMYANG[stemOrBranchIdx] === 'YANG';
  }
  return BRANCH_EUMYANG[stemOrBranchIdx] === 'YANG';
}

/**
 * 주어진 천간 또는 지지 인덱스가 음(陰)인지 판별한다
 *
 * @param stemOrBranchIdx - 천간(0-9) 또는 지지(0-11) 인덱스
 * @param type - 'STEM'(천간) 또는 'BRANCH'(지지) 구분
 * @returns 음(陰)이면 true, 양(陽)이면 false
 *
 * @example
 * isYin(1, 'STEM')   // true  — 乙(EUL)은 음간
 * isYin(0, 'STEM')   // false — 甲(GAP)은 양간
 * isYin(3, 'BRANCH') // true  — 卯(MYO)는 음지
 */
export function isYin(stemOrBranchIdx: number, type: 'STEM' | 'BRANCH'): boolean {
  return !isYang(stemOrBranchIdx, type);
}

/**
 * 두 천간 또는 두 지지의 음양 극성(極性)이 같은지 판별한다
 *
 * 합화(合化) 조건 확인, 음양 배합 판단 등에 활용한다.
 *
 * @param a - 첫 번째 천간(0-9) 또는 지지(0-11) 인덱스
 * @param b - 두 번째 천간(0-9) 또는 지지(0-11) 인덱스
 * @param type - 'STEM'(천간) 또는 'BRANCH'(지지) 구분
 * @returns 두 인덱스의 음양이 같으면 true, 다르면 false
 *
 * @example
 * isSamePolarity(0, 2, 'STEM')  // true  — 甲(0, YANG)과 丙(2, YANG)은 같은 양
 * isSamePolarity(0, 1, 'STEM')  // false — 甲(0, YANG)과 乙(1, YIN)은 다른 극성
 * isSamePolarity(0, 6, 'BRANCH') // true — 子(0, YANG)과 午(6, YANG)은 같은 양
 */
export function isSamePolarity(a: number, b: number, type: 'STEM' | 'BRANCH'): boolean {
  return isYang(a, type) === isYang(b, type);
}
